
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Búsqueda de Canchas - Refactorizada</title>
  <link rel="stylesheet" href="../css/master.css" />
</head>
<body>
  <header>
    <a href="../index.html"><img class="logoPumaf" src="../img/logo.webp" alt="Logo PUMAF" /></a>
    <nav>
      <ul class="linksPumaf">
        <li><a href="#">Item 1</a></li>
        <li><a href="./reservas.html">Reservas</a></li>
        <li><a href="./login.html">Iniciar Sesión</a></li>
        <li><a href="./registro.html">Registrarse</a></li>
        <li><a href="./perfilUsuario.html?userId=40972817">
          <img src="https://placehold.co/100x100" alt="Perfil usuario" class="imagenHeader" /></a>
        </li>
      </ul>
    </nav>
  </header>

  <main class="background">
    <section class="cards" id="cardsContainer"></section>

    <div id="modalCanchas" class="modal hidden">
      <div class="modal-content">
        <span id="cerrarModal" class="close">&times;</span>
        <h2>Canchas del Club</h2>
        <div id="contenedorCanchas"></div>
      </div>
    </div>
  </main>

  <footer>
    <div class="footer">
      <div class="logoFooter"><ion-icon name="tennisball-outline"></ion-icon></div>
      <div class="contacto">
        <p class="footerTitulos">Contacto</p>
        <a href="mailto:pumaf@gmail.com">pumaf@gmail.com</a>
        <a href="tel: 555-555-5555">Tel: 555-555-5555</a>
        <address>Rodriguez 432 - Mendoza</address>
      </div>
      <div class="preguntasFrecuentes">
        <p class="footerTitulos">FAQ</p>
        <a href="./faq.html#nosotros">Sobre Nosotros</a>
        <a href="./faq.html#reservasCanchas">Reservas y Canchas</a>
        <a href="./faq.html#pagosCanchas">Pagos y Canchas</a>
        <a href="./faq.html#otrasPreguntas">Otras Preguntas</a>
      </div>
      <div class="social">
        <p class="footerTitulos">¿Quieres Recibir nuestras últimas novedades?</p>
        <form class="novedadesFormulario">
          <input type="email" placeholder="correo@ejemplo.com" />
          <button type="submit">Suscribirse</button>
        </form>
        <p class="footerTitulos">Nuestras Redes</p>
        <div class="redes">
          <a href="https://www.facebook.com" target="_blank"><ion-icon name="logo-facebook"></ion-icon></a>
          <a href="https://www.instagram.com" target="_blank"><ion-icon name="logo-instagram"></ion-icon></a>
          <a href="https://x.com" target="_blank"><ion-icon name="logo-twitter"></ion-icon></a>
        </div>
      </div>
    </div>
    <div class="legal">PUMAF 2025 &copy; Todos los Derechos Reservados</div>
  </footer>

  <!-- Ionicons -->
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const clubes = JSON.parse(sessionStorage.getItem('clubes') || '[]');
      const container = document.getElementById("cardsContainer");
      const modal = document.getElementById("modalCanchas");
      const cerrarModal = document.getElementById("cerrarModal");
      const contenedorCanchas = document.getElementById("contenedorCanchas");

      cerrarModal.onclick = () => {
        modal.classList.add("hidden");
        contenedorCanchas.innerHTML = "";
      };

      modal.addEventListener("click", e => {
        if (e.target === modal) {
          modal.classList.add("hidden");
          contenedorCanchas.innerHTML = "";
        }
      });

      const mostrarCanchasDelClub = (club) => {
        contenedorCanchas.innerHTML = `
          <table class="tablaCanchas">
            <thead><tr><th>Cancha</th><th>Superficie</th><th>Techada</th><th>Precio</th><th>Horarios</th></tr></thead>
            <tbody>
              ${(club.canchas || []).map(cancha => `
                <tr onclick="window.location.href='confirmarCancha.html'">
                  <td>${cancha.nro_cancha}</td>
                  <td>${cancha.tipo_superficie?.tipo_superficie || 'N/A'}</td>
                  <td>${cancha.techada ? 'Sí' : 'No'}</td>
                  <td>${cancha.precio || '-'}</td>
                  <td>${(cancha.horarios || []).join(', ')}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;
        modal.classList.remove("hidden");
      };

      clubes.forEach(club => {
        const article = document.createElement('article');
        article.className = 'cardCancha';
        
        article.innerHTML = `
          <div class="cardHead">
            <a href="#" class="linkClub">
              <img src="${club.logo || 'https://placehold.co/350x200'}" alt="${club.nombre_fantasia || 'Club'}" />
            </a>
          </div>
          <div class="cardBody">
            <h2>${club.nombre_fantasia}</h2>
            <p class="detalle"><ion-icon name="compass-outline"></ion-icon> ${club.domicilio?.calle || ''} ${club.domicilio?.numeracion || ''}</p>
            <button class="btn btnVerCanchas">Ver Canchas</button>

        // Encabezado con link solo en la imagen
        const cardHead = document.createElement('div');
        cardHead.className = 'cardHead';
        cardHead.innerHTML = `
          <a href="./datosClub.html?clubId=${c.club.id}">
            <img 
              src="${c.club?.logo || 'https://placehold.co/350x200'}" 
              alt="${c.club?.nombre_fantasia || 'Cancha'}"
            />
          </a>
        `;

        // Cuerpo con info y click para abrir modal
        const cardBody = document.createElement('div');
        cardBody.className = 'cardBody';
        cardBody.innerHTML = `
          <h2>${c.club?.nombre_fantasia || 'Cancha sin nombre'}</h2>
          <p class="detalle">
            <ion-icon name="compass-outline"></ion-icon>
            ${c.domicilio?.calle || ''} ${c.domicilio?.numeracion || ''}
          </p>
          <p class="detalle">
            <strong>Cancha #${c.nro_cancha}</strong> · 
            ${c.tipo_superficie?.tipo_superficie || ''}
            · ${c.techada ? 'Techada' : 'Al aire libre'}
          </p>
          ${ c.precio 
            ? `<span>$${c.precio}</span>` 
            : ''
          }
          <div class="buttonsTurno">
            ${ (c.turnos || []).map(h => 
                `<button class="btn">${h.hora_inicio}</button>`
              ).join('')
            }
          </div>
        `;

        // Agregar listeners después de crear el contenido
        article.querySelector('.linkClub').addEventListener('click', (e) => {
          e.preventDefault();
          const clubKey = `club_${club.id}`;
          sessionStorage.setItem(clubKey, JSON.stringify(club));
          window.location.href = `./datosClub.html?clubId=${club.id}`;
        });

        article.querySelector('.btnVerCanchas').addEventListener('click', () => {
          mostrarCanchasDelClub(club);
        });

        container.appendChild(article);
      });


      if (!clubes.length) container.innerHTML = '<p>No se encontraron resultados.</p>';
    });
  </script>
</body>
</html>
